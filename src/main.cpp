#include <QCommandLineParser>
#include <QCoreApplication>
#include <QFile>
#include <QProcess>
#include <QTextStream>
#include "HWI.h"

int main(int argc, char* argv[]) {
  QCoreApplication app(argc, argv);
  QCoreApplication::setApplicationName("Hardware-finder");
  QCoreApplication::setApplicationVersion("1.0");
  QCommandLineParser parser;

  parser.setApplicationDescription("CLI tool to read out hardware info.");
  parser.addHelpOption();
  parser.addVersionOption();

  QCommandLineOption targetFileOption(
      QStringList() << "t"
                    << "target-file",
      QCoreApplication::translate(
          "main", "Target <file-path> to write hardware-info to."),
      QCoreApplication::translate("main", "file-path"));
  parser.addOption(targetFileOption);

  parser.process(app);

  QString targetFile = parser.value(targetFileOption);

  QFile file(targetFile);
  if (file.open(QIODevice::ReadWrite)) {
    QTextStream stream(&file);
    stream << "Generated by Hardware-finder 1.0 \n";
    stream << "\nGeneral info:";
    stream << "\n-------------------------------------------";
    stream << "\n Product ID: " << HWI::productID().toLocal8Bit().constData();
    stream << "\n Machine ID: " << HWI::machineID().toLocal8Bit().constData();
    stream << "\n OS: " << HWI::os().toLocal8Bit().constData();
    stream << "\n Build: " << HWI::build().toLocal8Bit().constData();
    stream << "\n Version" << HWI::version().toLocal8Bit().constData();
    stream << "\n RAM: " << HWI::RAM().toLocal8Bit().constData();
    stream << "\n-------------------------------------------";
    stream << "\n\n";
    stream << "\nDisplay info:";
    stream << "\n-------------------------------------------";
    stream << "\nResolution: " << HWI::resolution();
    stream << "\nRefresh rate: " << HWI::refreshRate();
    stream << "\n-------------------------------------------";
    stream << "\n\n";
    stream << "\nProcessor info (CPU):";
    stream << "\n-------------------------------------------";
    stream << "\nCPU Name: " << HWI::CPUName().toLocal8Bit().constData();
    stream << "\nCPU Clock Speed: "
           << HWI::CPUClockSpeed().toLocal8Bit().constData();
    stream << "\n-------------------------------------------";
    stream << "\n\n";
    stream << "\nGraphic card info (GPU):";
    stream << "\n-------------------------------------------";
    for (const auto& GPU : HWI::GPUs()) {
      stream << "\nName: " << GPU.name.toLocal8Bit().constData();
      stream << "\nDriver version: "
             << GPU.driverVersion.toLocal8Bit().constData();
      stream << "\nVRAM: " << GPU.VRAM.toLocal8Bit().constData();
      stream << "\n-------------------------------------------";
    }
  }

  return 0;
}
